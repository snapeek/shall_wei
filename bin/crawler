#!/usr/bin/env ruby

require File.expand_path("../../app/crawlers/weibo_crawl", __FILE__)

@weibo = WeiboCrawl.new
def login(username = nil, password = nil)
  @weibo.username = username if username
  @weibo.password = password if password
  if @weibo.login 
    @weibo.load_status 
  else
    puts("登录失败")
  end
end

def set_delay(_d)
  @weibo.delay = _d 
end

def search(keyword, page = nil)
  time_now = Time.now
  while true
    start_time = (time_now - 3.hours).strftime("%F-%H")
    end_time = time_now.strftime("%F-%H")
    @weibo.search(keyword: keyword, page: page || 1, starttime: start_time, endtime: end_time)
    time_now -= 3.hours
  end
end

puts "
# ==============================================
#
#       登陆      login username, password
#       搜索      search keyword[, page]
#       设置间隔  set_delay 3..6(default)
#       退出      ctrl + c[d] or exit!
#
# ==============================================
" 
pry